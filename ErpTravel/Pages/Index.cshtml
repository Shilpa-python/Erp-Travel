@page
@model IndexModel
@{
    ViewData["Title"] = "Travel Agency ERP";
}

<h1>Company Name</h1>
<div class="container">
    <div class="form-container">
        <form method="post" asp-page="/Quotation" id="bookingForm">

            <div>
                <!-- Non-changeable label for Destination Management Company -->
                <h3>Destination Management Company</h3>
            

            
                <!-- Label and input for Agency Name -->
                <label for="AgencyName">Agency Name:</label>
                <input type="text" id="AgencyName" name="AgencyName" required />
           

            
                <!-- Label and input for Agency Location -->
                <label for="AgencyLocation">Location:</label>
                <input type="text" id="AgencyLocation" name="AgencyLocation" />
            
                <!-- Label and input for Agency Number -->
                <label for="AgencyNumber">Contact Number:</label>
                <input type="number" name="AgencyNumber" asp-for="AgencyNumber" required min="1" />


           
      
         <label for="adults">Number of Adults</label>
            <input type="number" id="adults" name="Adults" min="1" required oninput="updateVehicleSuggestion(); onchange= updateRoomOptions()" />

         <label for="children">Number of Children</label>
            <input type="number" id="children" name="Children" min="0" required onchange="updateRoomOptions(); oninput=updateVehicleSuggestion(); updateItinerary();" />

           
                <!-- Label and input for Nights (Days calculated automatically based on Nights) -->
                <label for="Nights">Number of Nights:</label>
                <input type="number" id="Nights" name="Nights" value="1" min="1" required onchange="updateRoomOptions(); oninput=calculateTotal()" />
                <!-- Hidden field to store days -->
                <input type="hidden" id="Days" name="Days" required oninput="updateVehicleSuggestion(); updateItinerary();" />
            

            
                <!-- Label for Arrival Date -->
                <label for="ArrivalDate">Arrival Date:</label>
                <input type="date" id="ArrivalDate" name="ArrivalDate" required />
            </div>

 
    <h4>Hotel Room Booking</h4>

    <label for="rooms">Number of Rooms</label>
            <input type="number" id="rooms" name="Rooms" min="1" max="100" required onchange="updateRoomOptions(); oninput=calculateTotal()" />

            <label for="cwb">Number of Children with Bed</label>
    <input type="number" id="cwb" name="ChildrenWithBed" />

    <label for="cwob">Number of Children without Bed</label>
    <input type="number" id="cwob" name="ChildrenWithoutBed" />

    <label for="extraBeds">Number of Extra Beds</label>
    <input type="number" id="extraBeds" name="ExtraBeds" />

            <div>
                <label for="room">Room Type</label>
                <select id="room" name="RoomType" required onchange="updateRoomOptions(); calculateTotal();">
                    <option value="Select">Select Room Type</option>
                    <!-- Options will be populated dynamically -->
                </select>


                <!-- Add Room Type Preferences -->
                <button type="button" onclick="addRoomPreference()">Add Another Room</button>

                <!-- Container to show multiple room preferences -->
                <div id="room-preferences"></div>
                
            </div>


            <!--<label>Total Amount :</label>-->
    <!--<span id="totalAmount">INR 0</span>-->
            <input type="hidden" id="totalAmountHidden" name="TotalRoomAmount" />
    <br><br>

    <h4>Transportation</h4>

    <label for="vehicle">Suggested Vehicle</label>
    <select id="vehicle" name="Vehicle" required readonly>
               <!-- This will be filled automatically based on total number of people -->
    </select>

    <input type="hidden" id="suggestedVehicleHidden" name="SuggestedVehicle" />


    <p id="vehicle-rent"></p>
    <input type="hidden" id="vehicleRentHidden" name="TotalVehicleRent" /><!-- Display vehicle rent per day -->

    <h4>Select Itinerary</h4>
            <label for="itineraryType">Itinerary Selection Method:</label>
            <select id="itineraryType" name="ItineraryType" onchange="toggleItineraryMode();">
                <option value="auto">Auto-generate Itinerary Based on Days</option>
                <option value="manual">Select from Predefined Itinerary</option>
            </select>

            <div id="predefinedItinerarySection" style="display: none;">
                <label for="itinerarySelect">Choose a Predefined Itinerary:</label>
                <select id="itinerarySelect" name="Itinerary" onchange="updateItineraryDisplay();">
                    <option value="">Select Itinerary</option>
                    <option value="Itinerary1">Itinerary 1: City Tour & Cultural</option>
                    <option value="Itinerary2">Itinerary 2: Adventure & Nature</option>
                    <option value="Itinerary3">Beach & Relaxation</option>
                </select>
            </div>
            

            <div id="itineraryDisplay"></div>

    <input type="submit" value="Submit" />

    
</form>
</div>


    
       
    

</div>

<style>
    .container {
        display: flex;
        justify-content: flex-start;
        margin-top: 20px;
    }

    .form-container {
        flex: 1; /* Takes up available space */
        padding-right: 20px; /* Space between form and itinerary */
    }

    
</style>


<script>
    function calculateDays() {
        var nights = parseInt(document.getElementById('Nights').value) || 0;
        var days = parseInt(nights) + 1; // Add 1 to nights to get days
        document.getElementById('Days').value = days; // Set hidden days value

        // Call vehicle update after days are calculated
        updateVehicleSuggestion();
    }

    const roomOptions = {
        'Superior': {
            '3star': 1500,
            '4star': 2000,
            '5star': 2500
        },
        'Deluxe': {
            '3star': 2000,
            '4star': 2500,
            '5star': 3000
        },
        'DeluxePremiere': {
            '3star': 2500,
            '4star': 3000,
            '5star': 3500
        },
        'FamilySuite': {
            '3star': 3000,
            '4star': 3500,
            '5star': 4000
        }
    };

    function updateRoomOptions() {
        const adults = parseInt(document.getElementById('adults').value);
        const children = parseInt(document.getElementById('children').value) || 0;
        const totalOccupants = adults + children; // Total occupants (adults + children)
        const roomCount = parseInt(document.getElementById('rooms').value) || 1; // Get the selected number of rooms
        const occupantsPerRoom = Math.ceil(totalOccupants / roomCount); // Calculate occupants per room

        const roomSelect = document.getElementById('room');
        roomSelect.innerHTML = ''; // Clear current options

        // Define room type availability based on the number of occupants per room
        let availableOptions = [];
        if (occupantsPerRoom >= 1 && occupantsPerRoom <= 2) {
            availableOptions = ['Superior', 'Deluxe'];
        } else if (occupantsPerRoom == 3) {
            availableOptions = ['Deluxe', 'DeluxePremiere'];
        } else if (occupantsPerRoom >= 4 && occupantsPerRoom <= 8) {
            availableOptions = ['FamilySuite'];
        }

        // Populate the room dropdown with appropriate options
        availableOptions.forEach(type => {
            const optGroup = document.createElement('optgroup');
            optGroup.label = type.replace(/([A-Z])/g, ' $1').trim(); // Add space to the room type label

            for (const star in roomOptions[type]) {
                const roomPrice = roomOptions[type][star]; // Get the base room price

                const option = document.createElement('option');
                option.value = `${type}-${star}`;
                option.setAttribute('data-price', roomPrice); // Set the price for the selected room
                option.textContent = `${star.replace('star', ' Star')} - ${optGroup.label} - INR ${roomPrice}`; // Display the room type with price

                optGroup.appendChild(option);
            }
            roomSelect.appendChild(optGroup);
        });

        if (totalOccupants > 8) {
            alert('For more than 8 occupants, please select multiple rooms.');
        }
    }



    function calculateTotal() {
        // Get the values from the form
        var rooms = parseInt(document.getElementById("rooms").value) || 0;
        var nights = parseInt(document.getElementById("Nights").value) || 0;
        var cwb = parseInt(document.getElementById("cwb").value) || 0;
        var pricePerBed = 150; // Assuming price for each bed; update as needed
        var totalCWB = cwb * pricePerBed; // Calculate total for children with bed

        var extraBeds = parseInt(document.getElementById("extraBeds").value) || 0;
        var totalExtraBeds = extraBeds * pricePerBed;
        // Calculate the total cost

        var roomSelect = document.getElementById("room");
        var pricePerRoom = parseFloat(roomSelect.options[roomSelect.selectedIndex].getAttribute('data-price')) || 0;

        var totalAmount = (rooms * pricePerRoom * nights) + totalCWB + totalExtraBeds;

        // Display the total amount
        document.getElementById("totalAmount").textContent = "INR " + totalAmount.toFixed(2);
        document.getElementById("totalAmountHidden").value = totalAmount;
    }

    function addRoomPreference() {
        const adults = parseInt(document.getElementById('adults').value);
        const roomPreferencesContainer = document.getElementById('room-preferences');

        // Add another room preference selector for additional rooms
        const div = document.createElement('div');
        div.className = 'room-preference';
        const roomLabel = document.createElement('label');
        roomLabel.textContent = `Room Preference for ${adults} Adults`;
        div.appendChild(roomLabel);

        const roomSelect = document.createElement('select');
        roomSelect.name = 'RoomType';
        roomSelect.onchange = calculateTotal;
        roomSelect.required = true;

        const availableOptions = document.getElementById('room').innerHTML;
        roomSelect.innerHTML = availableOptions; // Use the existing options

        div.appendChild(roomSelect);
        roomPreferencesContainer.appendChild(div);
    }

    
     
    function updateVehicleSuggestion() {
        var days = parseInt(document.getElementById("Days").value) || 0;
        var adults = parseInt(document.getElementById("adults").value) || 0;
        var children = parseInt(document.getElementById("children").value) || 0;

        var totalPeople = adults + children;

        var vehicleOptions = {
            car: { label: "Car", rentPerDay: 500 },
            suv: { label: "SUV", rentPerDay: 800 },
            minivan: { label: "Mini Van", rentPerDay: 1000 },
            bus: { label: "Bus", rentPerDay: 1500 }
        };

        let suggestedVehicle;
        if (totalPeople <= 4) {
            suggestedVehicle = vehicleOptions.car;
        } else if (totalPeople === 5) {
            suggestedVehicle = vehicleOptions.suv;
        } else if (totalPeople === 6 || totalPeople === 7) {
            suggestedVehicle = vehicleOptions.minivan;
        } else {
            suggestedVehicle = vehicleOptions.bus;
        }

        var vehicleSelect = document.getElementById("vehicle");
        vehicleSelect.innerHTML = `<option value="${suggestedVehicle.label}">${suggestedVehicle.label}</option>`;

        document.getElementById("suggestedVehicleHidden").value = suggestedVehicle.label;

        // Calculate the total vehicle rent
        var vehicleRent = suggestedVehicle.rentPerDay * days;
        document.getElementById("vehicle-rent").textContent = `Vehicle Rent per Day: ${suggestedVehicle.rentPerDay}. Total Rent for ${days} day(s): ${vehicleRent}`;
        document.getElementById("vehicleRentHidden").value = vehicleRent;
    }

    function toggleItineraryMode() {
        var itineraryType = document.getElementById("itineraryType").value;
        var predefinedItinerarySection = document.getElementById("predefinedItinerarySection");
        if (itineraryType === "manual") {
            predefinedItinerarySection.style.display = "block";
            document.getElementById("itineraryDisplay").innerHTML = "";
        } else {
            predefinedItinerarySection.style.display = "none";
            generateItinerary();
        }
    }

    function generateItinerary() {
        var days = parseInt(document.getElementById("Days").value) || 0;
        var itineraryDisplay = document.getElementById("itineraryDisplay");
        if (document.getElementById("itineraryType").value === "manual") return;

        itineraryDisplay.innerHTML = "";
        var itineraryTemplate = [
            "Day 1: Arrival and transfer to the hotel.",
            "Day 2: City tour - Visit landmarks and cultural sites.",
            "Day 3: Explore local markets and shopping districts.",
            "Day 4: Relaxation day at the beach or local park.",
            "Day 5: Adventure day - Outdoor activities.",
            "Day 6: Final day - Departure."
        ];

        for (var i = 0; i < days; i++) {
            var dayText = itineraryTemplate[i] || `Day ${i + 1}: Custom itinerary for this day.`;
            itineraryDisplay.innerHTML += `<p>${dayText}</p>`;
        }
    }

    function updateItinerary() {
        generateItinerary();
    }

    function updateItineraryDisplay() {
        var days = parseInt(document.getElementById("Days").value) || 0;
        var itinerarySelect = document.getElementById("itinerarySelect").value;
        var itineraryDisplay = document.getElementById("itineraryDisplay");
        
        itineraryDisplay.innerHTML = "";
        
       

        if (itinerarySelect === "Itinerary1") {
            // Create Itinerary 1
            for (var i = 0; i < days; i++) {
                if (i === 0) {
                    itineraryDisplay.innerHTML += `<p>Day 1: Arrival and City Tour.</p>`;
                } else if (i === 1) {
                    itineraryDisplay.innerHTML += `<p>Day 2: Cultural visits and Museums.</p>`;
                } else if (i === 2) {
                    itineraryDisplay.innerHTML += `<p>Day 3: Departure.</p>`;
                } else {
                    itineraryDisplay.innerHTML += `<p>Day ${i + 1}: Free day for personal exploration.</p>`;
                }
            }
        } else if (itinerarySelect === "Itinerary2") {
            // Create Itinerary 2
            for (var i = 0; i < days; i++) {
                if (i === 0) {
                    itineraryDisplay.innerHTML += `<p>Day 1: Adventure Trek.</p>`;
                } else if (i === 1) {
                    itineraryDisplay.innerHTML += `<p>Day 2: Nature walk and Safari.</p>`;
                } else if (i === 2) {
                    itineraryDisplay.innerHTML += `<p>Day 3: Departure.</p>`;
                } else {
                    itineraryDisplay.innerHTML += `<p>Day ${i + 1}: Optional adventure activities.</p>`;
                }
            }
        } else if (itinerarySelect === "Itinerary3") {
            // Create Itinerary 3
            for (var i = 0; i < days; i++) {
                if (i === 0) {
                    itineraryDisplay.innerHTML += `<p>Day 1: Relax on the Beach.</p>`;
                } else if (i === 1) {
                    itineraryDisplay.innerHTML += `<p>Day 2: Explore the Coastal town.</p>`;
                } else if (i === 2) {
                    itineraryDisplay.innerHTML += `<p>Day 3: Departure.</p>`;
                } else {
                    itineraryDisplay.innerHTML += `<p>Day ${i + 1}: Leisure activities by the beach.</p>`;
                }
            }
        }
    }



    // Initial calculation on page load
    window.onload = function () {

        calculateDays();
        updateRoomOptions();
        calculateTotal();
        updateVehicleSuggestion();
        toggleItineraryMode(); // Initialize the itinerary
        updateItinerary();
        updateItineraryDisplay();
    };

</script>

